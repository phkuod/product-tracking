#!/bin/sh
# Pre-commit hook to run linting and basic checks

echo "Running pre-commit checks..."

# Check if npm is available
if ! command -v npm &> /dev/null; then
    echo "npm not found. Skipping pre-commit checks."
    exit 0
fi

# Run linting if available
if npm run lint --silent 2>/dev/null; then
    echo "✅ Linting passed"
else
    echo "⚠️  Linting not configured or failed"
fi

# Check for large files (>1MB)
large_files=$(git diff --cached --name-only --diff-filter=A | xargs -I {} find {} -size +1M 2>/dev/null)
if [ -n "$large_files" ]; then
    echo "❌ Large files detected (>1MB):"
    echo "$large_files"
    echo "Consider using Git LFS for large files"
    exit 1
fi

# Check for secrets/keys (basic patterns)
secrets=$(git diff --cached --name-only | xargs grep -l -i -E "(api_key|password|secret|token|private_key)" 2>/dev/null || true)
if [ -n "$secrets" ]; then
    echo "⚠️  Potential secrets detected in:"
    echo "$secrets"
    echo "Please review and ensure no sensitive data is committed"
fi

echo "✅ Pre-commit checks completed"